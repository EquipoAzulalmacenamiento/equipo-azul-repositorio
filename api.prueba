#include <ArduinoJson.h>
#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>
#include <WiFiClient.h>

String server= "";

const char *ssid = "INFINITUMF3RV_2.4";
const char *password = "vfA2QQq39N";
//const char *ssid = "UbeeA3E4-2.4G";
//const char *password = "40BBFCA3E4";

//--------------------------------------
#define switchPin  4//D2
#define led1Pin 0//D3
#define led2Pin 2//D4


 

void setup()
{

   Serial.begin(9600);

  pinMode(switchPin, INPUT);

  pinMode(led1Pin,OUTPUT);    
  pinMode(led2Pin,OUTPUT);

Serial.println("WiFi connected");
  WiFi.mode(WIFI_STA);
  WiFi.begin(ssid, password);

  while(WiFi.status() != WL_CONNECTED)
  {
    delay(500);
  }

  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
}

void loop()
{
   if (WiFi.status() == WL_CONNECTED)
  {
    
  int switchVal;  

  switchVal = digitalRead(switchPin);

 if(switchVal == HIGH)
 {
   digitalWrite(led1Pin,HIGH);
   digitalWrite(led2Pin,LOW);
  
   Serial.println("Encendido");
    //btn="encendido";
   post("encendido");
   delay(1000);

 }
else
 {
   digitalWrite(led2Pin,HIGH);
   digitalWrite(led1Pin,LOW);
   Serial.println("Apagado");
  // btn="apagado";
   post("apagado");
   delay(1000);
 }
 }

}

void post(String btn) {
  Serial.println("Inicio post");
  HTTPClient http;
  String json;
  server ="http://192.168.1.73:3000/api/product";

  StaticJsonDocument<256>doc;
  doc["btn"]= String(btn);
  serializeJson(doc, json);
  
  http.begin(server);
  http.addHeader("Content-Type", "application/json");
  http.POST(json);
  http.writeToStream(&Serial);
  http.end();
  Serial.println ("Termino post");
  }
